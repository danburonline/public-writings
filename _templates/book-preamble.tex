% ! =============================
% ! # MARK: Book Template
% ! =============================
% Memoir class settings for technical books with chapter structure.
% Usage: \documentclass[11pt,a4paper,openany]{memoir}
%        \input{../../_templates/book-preamble.tex}
%
% Memoir provides: parts, chapters, appendices, indices, glossaries,
% advanced headers/footers, and superior typography.

% ! =======================
% ! # MARK: Package Loading
% ! =======================

\usepackage[T1]{fontenc}
\usepackage{tgtermes}
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{hhline}
\usepackage{makecell}
\usepackage{tabularx, booktabs}
\usepackage{enumitem}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{siunitx}
\usepackage{listings}
\usepackage{natbib}
\usepackage{microtype}
\usepackage{url}
\usepackage[breaklinks,linktocpage]{hyperref}

% Book-specific packages
\usepackage{makeidx}
\usepackage[toc]{appendix}


% ! ==============================
% ! # MARK: Page Layout & Geometry
% ! ==============================

% Memoir's stock and paper size (A4)
\setstocksize{297mm}{210mm}
\settrimmedsize{297mm}{210mm}{*}

% Page margins (generous for readability)
\setlrmarginsandblock{35mm}{30mm}{*}
\setulmarginsandblock{30mm}{35mm}{*}

% Header and footer spacing
\setheadfoot{15pt}{30pt}
\setheaderspaces{*}{15pt}{*}

% Apply the layout
\checkandfixthelayout


% ! ==========================
% ! # MARK: Typography & Fonts
% ! ==========================

% Line spacing (1.2 for readability)
\setSingleSpace{1.2}
\SingleSpacing

% Paragraph indentation and spacing
\setlength{\parindent}{1.5em}
\setlength{\parskip}{0pt}

% List formatting
\setlist[itemize]{noitemsep, topsep=7pt, partopsep=0pt, leftmargin=*, label=\textendash}
\setlist[enumerate]{noitemsep, topsep=7pt, partopsep=0pt, leftmargin=*}


% ! ================================
% ! # MARK: Chapter & Section Styles
% ! ================================

% Chapter style: clean, modern
\makechapterstyle{modernbook}{%
	\chapterstyle{default}
	\renewcommand*{\chapterheadstart}{\vspace*{40pt}}
	\renewcommand*{\chapnumfont}{\normalfont\HUGE\bfseries}
	\renewcommand*{\printchaptername}{}
	\renewcommand*{\chapternamenum}{}
	\renewcommand*{\printchapternum}{\chapnumfont \thechapter\quad}
	\renewcommand*{\afterchapternum}{}
	\renewcommand*{\chaptitlefont}{\normalfont\HUGE\bfseries}
	\renewcommand*{\printchaptertitle}[1]{\chaptitlefont ##1}
	\renewcommand*{\afterchaptertitle}{\par\nobreak\vskip 30pt}
}
\chapterstyle{modernbook}

% Section numbering depth (chapter.section.subsection)
\setsecnumdepth{subsection}
\settocdepth{subsection}

% Section heading styles
\setsecheadstyle{\Large\bfseries}
\setsubsecheadstyle{\large\bfseries}
\setsubsubsecheadstyle{\normalsize\bfseries}


% ! ================================
% ! # MARK: Headers & Footers
% ! ================================

% Page style: chapter name on left, section on right
\makepagestyle{bookstyle}
\makeevenhead{bookstyle}{\thepage}{}{\itshape\leftmark}
\makeoddhead{bookstyle}{\itshape\rightmark}{}{\thepage}
\makeevenfoot{bookstyle}{}{}{}
\makeoddfoot{bookstyle}{}{}{}

% Plain style for chapter openings
\makeevenfoot{plain}{}{\thepage}{}
\makeoddfoot{plain}{}{\thepage}{}

\pagestyle{bookstyle}


% ! ================================
% ! # MARK: Table of Contents
% ! ================================

% TOC styling
\renewcommand{\contentsname}{Contents}
\renewcommand{\listfigurename}{List of Figures}
\renewcommand{\listtablename}{List of Tables}

% Dotted leaders in TOC
\renewcommand{\cftchapterdotsep}{\cftdotsep}
\renewcommand{\cftsectiondotsep}{\cftdotsep}


% ! ================================
% ! # MARK: Floats, Figures & Tables
% ! ================================

\usepackage[font=small,skip=7pt,labelfont=bf]{caption}
\captionsetup{justification=raggedright}
\newcommand{\floatcaption}[2]{\caption[#1.]{#1~#2.}}


% ! ================================
% ! # MARK: Bibliography & Citations
% ! ================================

\renewcommand{\bibname}{References}
\setlength\bibindent{0pt}


% ! =====================
% ! # MARK: Code Listings
% ! =====================

\definecolor{codegreen}{rgb}{0,0.5,0}
\definecolor{codegray}{rgb}{0.4,0.4,0.4}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.96,0.96,0.96}
\definecolor{lightgray}{gray}{0.8}

\lstdefinelanguage{JavaScript}{
	keywords={break, case, catch, continue, debugger, default, delete, do, else, finally, for, function, if, in, instanceof, new, return, switch, this, throw, try, typeof, var, void, while, with},
	morecomment=[l]{//},
	morecomment=[s]{/*}{*/},
	morestring=[b]',
	morestring=[b]",
	sensitive=true
}

\lstdefinestyle{mystyle}{
	backgroundcolor=\color{backcolour},
	commentstyle=\color{codegreen},
	keywordstyle=\color{purple},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	basicstyle=\ttfamily\footnotesize,
	breakatwhitespace=false,
	breaklines=true,
	captionpos=b,
	frame=tb,
	framerule=0pt,
	framextopmargin=6pt,
	framexbottommargin=6pt,
	keepspaces=true,
	numbers=left,
	numbersep=5pt,
	showspaces=false,
	showstringspaces=false,
	showtabs=false,
	tabsize=2
}
\lstset{style=mystyle}


% ! ==========================
% ! # MARK: Hyperlinks & URLs
% ! ==========================

\hypersetup{
	colorlinks = true,
	urlcolor   = blue,
	linkcolor  = blue,
	citecolor  = blue,
	breaklinks = true
}
\PassOptionsToPackage{hyphens}{url}
\urlstyle{same}
\def\Urlmuskip{0mu plus 1mu}
\def\UrlBreaks{\do\/\do-}
\def\UrlBigBreaks{\do\/\do-\do:\do.}


% ! ==========================
% ! # MARK: Index Support
% ! ==========================

\makeindex


% ! =======================
% ! # MARK: Draft Watermark
% ! =======================

% Uncomment for draft mode:
% \usepackage{background}
% \backgroundsetup{contents=DRAFT, opacity=0.25, color=gray}


% ! ================================
% ! # MARK: Front/Back Matter Macros
% ! ================================

% Convenient macros for book structure
% Usage in main document:
%   \frontmatter  - roman numerals, no chapter numbers
%   \mainmatter   - arabic numerals, chapter numbers
%   \appendix     - appendix chapters (A, B, C...)
%   \backmatter   - no chapter numbers (index, bibliography)
