% ! ========================
% ! # MARK: Template Control
% ! ========================

% Defines the template variant. Can be 'essay' (default) or 'paper'.
% This command must come before the document class definition in the main file.
\providecommand{\templatevariant}{essay}


% ! =======================
% ! # MARK: Package Loading
% ! =======================

% Common Packages
\usepackage[T1]{fontenc} % Font encoding
\usepackage{tgtermes} % TeX Gyre Termes font (Times clone)
\usepackage{geometry} % Page layout control
\usepackage{setspace} % Line spacing control
\usepackage{graphicx} % Enhanced graphics
\usepackage{xcolor} % Color definitions
\usepackage{colortbl} % Color in tables
\usepackage{hhline} % Double horizontal lines in tables
\usepackage{makecell} % Thicker lines in tables
\usepackage{tabularx, booktabs} % Advanced table layouts
\usepackage{enumitem} % Custom list environments
\usepackage{amsmath} % Advanced math environments
\usepackage{amssymb} % Math symbols
\usepackage{siunitx} % SI units package
\usepackage{listings} % Code listings
\usepackage{natbib} % Bibliography and citations
\usepackage{authblk} % Author and affiliation blocks
\usepackage{tocloft} % ToC, LoF, LoT styling
\usepackage[nottoc]{tocbibind} % Add Bib, Index, etc., to ToC
\usepackage{microtype} % Improved typography (justification, spacing)
\usepackage{url} % URL formatting
\usepackage[breaklinks,linktocpage]{hyperref} % Hyperlinks (must be loaded late)

% Variant-Specific Packages
% Define variant names for comparison
\def\papervariant{paper}
\def\essayvariant{essay}

% Load packages only required for the 'paper' template
\ifx\templatevariant\papervariant
  \usepackage{multicol}     % For multi-column layout
  \usepackage{dblfloatfix}  % Fixes for double-column floats
\fi


% ! ==============================
% ! # MARK: Page Layout & Geometry
% ! ==============================

\ifx\templatevariant\papervariant
  % Paper Template Layout (Two-Column)
  \geometry{
    left=3cm,
    right=3cm,
    top=2.5cm,
    bottom=3cm
  }
  % Settings for two-column layout
  \setlength{\columnseprule}{0pt} % No vertical rule between columns
  \setlength{\columnsep}{0.7cm}   % Space between columns
\else
  % Essay Template Layout (Single-Column, Default)
  \geometry{
    left=4cm,
    right=4cm,
    top=3cm,
    bottom=3.5cm
  }
\fi


% ! ==========================
% ! # MARK: Typography & Fonts
% ! ==========================

% Page Numbering
\renewcommand{\thepage}{\footnotesize\arabic{page}}

% List Spacing
\setlist[itemize]{noitemsep, topsep=7pt, partopsep=0pt, leftmargin=*, label=\textendash}


% ! ================================
% ! # MARK: Floats, Figures & Tables
% ! ================================

% Float Placement Parameters
\renewcommand{\topfraction}{0.9}
\renewcommand{\bottomfraction}{0.8}
\renewcommand{\textfraction}{0.1}
\renewcommand{\floatpagefraction}{0.8}
% Additional float settings for two-column paper template
\ifx\templatevariant\papervariant
  \renewcommand{\dbltopfraction}{0.9}
  \renewcommand{\dblfloatpagefraction}{0.8}
\fi

% Caption Styling
\usepackage[font=footnotesize,skip=7pt,labelfont=bf]{caption}
\captionsetup{justification=raggedright} % Left-align all captions
\newcommand{\floatcaption}[2]{\caption[#1.]{#1~#2.}} % Custom caption command


% ! ================================
% ! # MARK: Bibliography & Citations
% ! ================================

\renewcommand{\bibname}{References} % Change bibliography title
\setlength\bibindent{0pt}           % No indentation for bibliography entries

% Adjust layout and font size in the bibliography environment
\let\oldthebibliography=\thebibliography
\let\endoldthebibliography=\endthebibliography
\renewenvironment{thebibliography}[1]{%
  \begin{oldthebibliography}{#1}%
    \raggedright%
    \footnotesize%
    \setlength{\itemsep}{3pt}%
    \setlength{\parsep}{0pt}%
    \setlength{\parskip}{0pt}%
    }{%
  \end{oldthebibliography}%
}


% ! =====================
% ! # MARK: Code Listings
% ! =====================

% Custom Colors for Code
\definecolor{codegreen}{rgb}{0,0.5,0}
\definecolor{codegray}{rgb}{0.4,0.4,0.4}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.96,0.96,0.96}
\definecolor{lightgray}{gray}{0.8}

% Language Definition (Example: JavaScript)
\lstdefinelanguage{JavaScript}{
  keywords={break, case, catch, continue, debugger, default, delete, do, else, finally, for, function, if, in, instanceof, new, return, switch, this, throw, try, typeof, var, void, while, with},
  morecomment=[l]{//},
  morecomment=[s]{/*}{*/},
  morestring=[b]',
  morestring=[b]",
  sensitive=true
}

% Listing Style Definition
\lstdefinestyle{mystyle}{
  backgroundcolor=\color{backcolour},
  commentstyle=\color{codegreen},
  keywordstyle=\color{purple},
  numberstyle=\tiny\color{codegray},
  stringstyle=\color{codepurple},
  basicstyle=\ttfamily\footnotesize,
  breakatwhitespace=false,
  breaklines=true,
  captionpos=b,
  frame=tb,
  framerule=0pt,
  framextopmargin=6pt,
  framexbottommargin=6pt,
  keepspaces=true,
  numbers=left,
  numbersep=5pt,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  tabsize=2
}
\lstset{style=mystyle} % Apply the defined style globally


% ! ===================================
% ! # MARK: Document Structure & Titles
% ! ===================================

% Table of Contents (ToC)
\renewcommand{\contentsname}{Table of Contents}
\renewcommand\cftsecafterpnum{\vskip8pt}              % Vertical space after section numbers
\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}} % Dotted leaders for sections

% List of Listings (LoL)
\renewcommand{\lstlistlistingname}{List of \lstlistingname s}


% ! ==========================
% ! # MARK: Hyperlinks & URLs
% ! ==========================

\hypersetup{
  colorlinks = true,
  urlcolor   = blue,
  linkcolor  = blue,
  citecolor  = blue,
  breaklinks = true
}
% URL Line Breaking
\PassOptionsToPackage{hyphens}{url}
\urlstyle{same}
\def\Urlmuskip{0mu plus 1mu}
\def\UrlBreaks{\do\/\do-}
\def\UrlBigBreaks{\do\/\do-\do:\do.}


% ! =======================
% ! # MARK: Draft Watermark
% ! =======================

% Uncomment the following lines to add a "DRAFT" watermark on every page.
% \usepackage{background}
% \backgroundsetup{contents=DRAFT, opacity=0.25, color=gray}
% Line Spacing
% \doublespacing % Uncomment for review drafts
